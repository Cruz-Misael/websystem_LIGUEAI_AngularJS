
<div *ngIf="loading">Carregando fatura...</div>


<div *ngIf="!loading && fatura" class="fatura-detalhe">
  <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
</div>

<div class="fatura-actions no-print">
  <button class="btn btn-secondary" (click)="voltar()">
    ‚¨Ö Voltar
  </button>
  <button class="btn btn-primary" (click)="imprimirFatura()">
    üñ® Imprimir
  </button>
</div>


  <div class="header">
    <img src="assets\logo_sebratel.png" alt="Sebratel" />
    <div>
      <h4>Sebratel Tecnologia LTDA</h4>
      <p>Porto Alegre/RS</p>
      <p>Contato: (51) 4000-6505</p>
      <p>CNPJ: 11.354.635/0001-53</p>
    </div>  
  </div>
  
  <h2>Comprovante de Fatura Sebratel</h2>

  <div class="info-container">
    <!-- Informa√ß√µes do Cliente -->
    <div class="info-box">
      <h3>Informa√ß√µes do Cliente</h3>
      <p><strong>Nome:</strong> {{ fatura.fantasyName }}</p>
      <p><strong>CPF/CNPJ:</strong> {{ fatura.document }}</p>
      <p><strong>Per√≠odo:</strong> 
        {{ fatura.summary?.start_measurement_date | date:'dd/MM/yyyy' }} 
        at√© 
        {{ fatura.summary?.final_measurement_date | date:'dd/MM/yyyy' }}
      </p>
    </div>

    <!-- Informa√ß√µes do Contrato -->
    <div class="info-box">
      <h3>Informa√ß√µes do Contrato</h3>
      <p><strong>N√∫mero:</strong> {{ fatura.contract_number }}</p>
      <p><strong>Valor da Assinatura:</strong> R$ 29,90 </p>
      <p><strong>Valor Total:</strong> {{ getValorTotal() | currency:'BRL' }}</p>
      <p><strong>Status:</strong> {{ fatura.status }}</p>
    </div>
  </div>

  <!-- Plano de Franquia -->
  <div class="planos">
    <h3>Informa√ß√µes do Plano de Franquia</h3>

    <table class="table">
      <thead>
        <tr>
          <th>Conta</th>
          <th>M√≠nimo</th>
          <th>M√°ximo</th>
          <th>Tipo</th>
          <th>Pre√ßo</th>
          <th>Dura√ß√£o Total</th>
          <th>Dura√ß√£o Bloco</th>
          <th>Valor</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let plano of fatura.detailedPlanLevels">
          <td>{{ plano.accountCode?.split('@')[0] }}</td>
          <td>{{ plano.min }}</td>
          <td>Ilimitado</td>
          <td>{{ plano.units.name }}</td>
          <td>{{ plano.price | currency:'BRL' }}</td>
          <td>{{ formatarDuracao(plano.duration) }}</td>
          <td>{{ formatarDuracao(plano.durationBlock) }}</td>
          <td>{{ plano.value | currency:'BRL' }}</td>
        </tr>
      </tbody>
    </table>
    <p class="total"><strong>Total de Conta:</strong> R$ 0.00</p>
    <p class="total"><strong>Total Geral:</strong> {{ getValorMinutagem() | currency:'BRL' }}</p>
  </div>


  <div *ngIf="fatura?.billed_items?.length">

    @for (tipo of getChamadasAgrupadasPorServico() | keyvalue; track tipo.key) {
      <h4 style="margin-top: 20px; color: #000000;">
        Servi√ßo: {{ tipo.key }}
      </h4>

      <table class="table table-striped table-sm">
        <thead class="table-primary">
          <tr>
            <th>Conta</th>
            <th>Data/Hora</th>
            <th>Dura√ß√£o</th>
            <th>Dura√ß√£o Bloco</th>
            <th>Origem</th>
            <th>Destino</th>
            <th>Valor</th>
          </tr>
        </thead>
        <tbody>
          @for (chamada of tipo.value; track chamada.begin_date) {
            <tr>
              <td>{{ chamada.accountcode?.split('@')[0] }}</td>
              <td>{{ chamada.begin_date | date:'dd/MM/yyyy HH:mm' }}</td>
              <td>{{ formatarDuracao(chamada.realDuration) }}</td>
              <td>{{ formatarDuracao(chamada.durationMinutes) }}</td>
              <td>{{ chamada.caller }}</td>
              <td>{{ chamada.callee }}</td>
              <td>{{ chamada.monetary_value | currency:'BRL' }}</td>
            </tr>
          }
        </tbody>
      </table>

      <p style="text-align: right; font-weight: regular; margin-top: 08px; font-size: small; ">
        <strong>Total  {{ tipo.key }}:</strong> {{ getTotalPorTipo(tipo.key) | currency:'BRL' }}
      </p>
      <hr />
    }
  </div>
  <div class="footer">
    Documento gerado automaticamente pelo sistema Sebratel ‚Äî
    {{ today | date:'dd/MM/yyyy HH:mm' }}
  </div>
</div>

<!-- DEBUG opcional -->
<!-- <pre>{{ fatura | json }}</pre> -->
